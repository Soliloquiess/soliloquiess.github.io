---
title: "[SQL] SQL 문법"
layout: post
subtitle: SQL
date: '2021-11-03-13:45:51 +0900'

categories: class
tags: SQL
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---

## SELET~FROM~where

###### Select은 구축이 완료된 테이블에서 데이터를 추출하는 기능을 한다.
아무리 많이 써도 기존의 데이터가 변하지는 않는다.

가장 기본형식은 *SELECT ~ FROM ~ WHERE*의 형태이다.

- select는 열이름, from은 뒤에 테이블 이름, where은 조건문이 뒤따라 온다.

![20211211_203816](/assets/20211211_203816.png)

-------

#### USE문

- select문을 실행하려면 먼저 사용할 디비를 지정해야 한다. 그러기 위해 USE를 사용한다.

```
SELECT 열 이름
FROM 테이블 이름
WHERE 조건식
GROUP BY 열 이름
HAVING 조건식
ORDER BY 열이름
LIMIT 숫자

```


#### 중복된 결과를 제거 : DISTINCT
- *DISTINCT*는 조회된 결과에서 중복된 데이터를 1개만 남긴다.

#### GROUP BY절

- 말 그대로 그룹으로 묶어주는 역할을 한다.


##### 집계함수

|함수명|설명|
|------|---|
|Sum()|합계를 구합니다.|
|Avg()|평균을 구합니다.|
|Min()|최소값을 구합니다.|
|Max()|최대값을 구합니다.|
|Count()|행을 구합니다.|
|Count(DISTINCT)|행의 개수를 셉니다(중복은 1개만 인정)|


#### Having 절

결과중 총 구매엑이 1000이상인 회원에게만 사은품을 주려면?

조건을 포함한 where절만으로는 안된다.
***(집계함수는 where절 안에 못나온다)***


```
SELECT mem_id "회원 아이디", SUM(price*amount) "총 구매 금액"
   FROM buy
   GROUP BY mem_id   
   HAVING SUM(price*amount) > 1000 ;
```

이렇게 group by로 묶은 뒤 집계함수를 사용해야한다.(where절 대신)

- ORDER BY는 결과가 출력되는 순서를 조절함.
- LIMIT 는 출력하는 개수를 제한하며 주로 order by와 같이 사용
- DISTINCT 는 조회된 결과에서 중복된 것은 1개만 남기며 열 이름앞에 붙여주면 된다.
- GROUP BY 는 데이터를 그룹으로 묶어주는 기능을 한다.
- HAVING은 집계함수와 관련된 조건을 제한하며 GROUP BY 다음에 나온다.


-----

### 데이터 변경을 위한 SQL 문
-

#### 데이터 입력: insert
- 테이블에 행 데이터 입력하는 기본적인 SQL문은 insert이다.

insert into 테이블[(열1,열2...)] values (값1,값2)


##### 자동으로 증가하는 Auto_increment

- 열을 정의할 떄부터 1부터 증가하는 값을 입력해줌. 주의할 점은 Auto_increment(AI)로 지정한 열은 꼭 *Primary key* 로 지정해줘야한다.



###### 덤)시스템 변수

시스템 변수란 MYSQL에서 자체적으로 가지고 있는 설정값이 저장된 변수. 주로 MYSQL의 환경이과 관련된 내용이 저장되어 있으며, 그 개수는 500개 이상이다.

시스템 변수는 앞에 @@가 붙는것이 특징이며, 시스템 변수의 값을 확인하려면 *SELECT @@시스템변수* 를 실행하면 된다.

전체 시스템 변수를 알고 싶으면 SHOW GLOBAL VAIABLES를 실행하면 된다.


##### 다른 테이블의 데이터를 한번에 입력하는 insert into ~ select
많은 양의 데이터를 직접 타이핑 하면 오래 걸린다. 다른 테이블에 이미 데이터가 입력되어 있으면 *insert into~ select* 구문을 사용해 해당 테이블의 데이터를 가져와서 한번에 입력할 수 있다.




#### 데이터 수정: update

행 데이터 수정해야 하는 경우 사용.

###### WHERE 가 없는 update문
update에서 where절은 문법상 생략이 되지만 where이 없으면 테이블의 모든 해으이 값이 변경된다.

```
update city
set city_name = "서울"
```
을 실행하면 모든 도시가 서울로 바뀐다.

#### 데이터 삭제 :  DELETE

행 데이터를 삭제하는 경우 사용.


###### 대용량 테이블의 삭제는?

몇억건의 데이터가 있는 테이블이 필요 없어지면?

DELETE 문은 삭제가 오래 걸린다. 몇억건이면 훨씬 오래 걸린다(하나 삭제에 2초라 치면)
DROP은 테이블 자체를 삭제한다.

TRUNCATE 문도 DELETE 문과 동일한 효과를 내지만 속도가 무척 빠르다.

###### DROP은 테이블이 아예 사라지지만 DELETE과 TUNCATE는 빈 테이블을 남긴다.

- insert문은 테이블에 데이터를 입력하는 명령어다.
- Autu_increment는 1부터 증가하는 값을 자동으로 입력해준다. 해당 키는 primary키로 줘야한다.
- insert into ~ select는 다른 테이블의 데이터를 가져와서 한번에 대량으로 입력한다.
- update는 기존에 입력되어 있는 값을 수정하며 주로 where과 함꼐 사용된다.
- delete 는 행 단위로 삭제하며 where가 없으면 전체행이 삭제된다.


|한글 용어|약자|설명|
|------|---|---|
|NULL||아무것도 없는 값, Auto_increment 열에 값을 입력|
|Primary key|PK|기본키, Auto_increment열은 기본키로 지정해야 한다.|
|Alter table||테이블 구조를 변형하는 SQL|
|시스템 변수||Mysql에서 자체적으로 가지고 있는 설정값이 저장된 변수|
|@@Auto_increment_increment||Auto_increment의 증가값을 지정하는 시스템 변수|
|Describe|DESC|테이블 구조를 확인하는 SQL|
|Alter table||DELETE와 비슷하지만 전체 행 삭제시 사용|


------------


## MYSQL의 데이터 형식

테이블을 만들 떄는 데이터 형식을 설정해야 한다.
데이터 형식에는 크게 숫자형, 문자형, 날짜형이 존재하며 세부적으로 더 나뉘기도 한다.

이렇게 다양한 데이터 형식이 있는 이유는 실제 저장될 데이터의 형태가 다양하기 떄문


### 데이터 형식

- MySQL에서 제공하는 데이터 형식은 수십개이고 각 데이터 형식마다 크기나 표현할 숫자의 범위가 다르다. 이를 모두 외울 필요는 없으나 자주 사용하는 것은 알아둬야한다.


#### 변수의 사용

 SQL 도 다른 일반 프로그래밍 언어처럼 변수를 선언하고 사용할 수 있다. *변수*의 언과 값의 대입은 다음 형식을 따른다.



```
set @변수이름 = 변수의 값; -> 변수의 선언 및 값의 대입
select @변수 이름; -> 변수의 값 출력
```

- Mysql에선 '@변수이름'을  이용해서 변수를 만들고 set문 으로 값을 대입한다.

Limit에도 변수를 쓰려면?

```
SET @count = 3;
SELECT mem_name, height FROM member ORDER BY height LIMIT @count;
```

이렇게 Limit에 변수를 쓰면 에러가 난다.


이를 해결하는 것이 prepare과 execute이다.


```
SET @count = 3;
PREPARE mySQL FROM 'SELECT mem_name, height FROM member ORDER BY height LIMIT ?';
EXECUTE mySQL USING @count;
```

#### 데이터 형변환

문자를 정수형으로 바꾸거나 정수를 문자로 바꾸거나 이런걸 데이터의 형변환이라 부른다.  형변환은 직접함수를 사용해서 변환하는 명시적 형변환과 별도의 지시 없이 자연스럽게 변환되는 암시적 변환이 있다.

###### 함수를 이용한 명시적 형변환
데이터 형식을 변환하는 함수는 CAST(), CONVERT()이다. CAST(),CONVERT는 형식만 다를 뿐 동일한 기능을 한다.

- CAST(값 AS 데이터 형식 [(길이)])
- CONVERT(값 AS 데이터 형식 [(길이)])


```
SELECT CAST(AVG(price) AS SIGNED)  '평균 가격'  FROM buy ;
-- 또는
SELECT CONVERT(AVG(price) , SIGNED)  '평균 가격'  FROM buy ;
```

SQL 결과를 원하는 형태로 표현할 떄도 사용이 가능하다(select절)
가격과 수량을 곱한 실제 구매액을 표시하는 SQL을 다음과 같이 작성할 수 있다.

##### 암시적인 변환
- CAST()나 CONVERT()함수를 쓰지 않고도 자연스레 형이 변환 되는 것을 말한다.
