---
title: "[AWS] AWS 인스턴스 생성 및 설정"
layout: post
subtitle: AWS&Docker
date: '2022-06-30 19:45:51 +0900'

categories: study
tags: AWS&Docker
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---




인스턴스 실행 방법 까먹을까봐 기록해 두는 곳.(항상 안하면 까먹는다 ㅠ)


<br>
1 . 단계 1: Amazon Machine Image(AMI) 선택


![20220630_204818](/assets/20220630_204818.png)

여기서 프리티어인 Window Server 2019 base를 선택한다.

<br>
2 . 단계 2: 인스턴스 유형 선택


![20220630_204952](/assets/20220630_204952.png)

그대로인 프리티어 설정 선택 그리고 검토 및 시작을 누르게 되면

"단계 7: 인스턴스 시작 검토" 로 바로 이동하게 된다.


<br>

3 .  단계 7: 인스턴스 시작 검토

![20220630_205709](/assets/20220630_205709.png)


바로 2단계에서 7단계로 오는 데 시작하기를 누르게 되면 인스턴스 생성이 완료 된다.

<br>

----



#### ※ 기존 키 페어 생성 또는 새 키 생성


![20220630_211231](/assets/20220630_211231.png)

 저기 우측 상단 지역 설정이 있는데 만약 키를 만들었음에도 새키페어 등록이 나오거나 기존키 페어를 봤는데 없을 경우가 있다.

 만약 서울 선택하고 키를 만들었는데 설정이 미국 오하이오 북부거나 이런식으로 다르게 설정이 되어있으면 키가 안 나와서 적는다.


 -----

![20220630_213450](/assets/20220630_213450.png)

 생성 후 상태검사에 가보면 통과 했다고 알려주게 된다.



![20220701_094757](/assets/20220701_094757.png)

그리고 위에 인스턴스 부분을 체크하고 연결을 선택

<br>
----

![20220701_094955](/assets/20220701_094955.png)

그리고 클릭하게 되면 위와 같은 화면이 나온다.

인스턴스 연결이 나오면 RDP 클라이언트로 가서 아래 보면 원격 데스크톱 파일 다운로드가 있다.


###### 원격 데스크톱 파일은 원격 서버에 연결할 수 있는 정보가 담긴 파일. 바로가기와 유사하고 원격 서버에 연결할 떄는 이 파일을 더블클릭한다.


![20220701_095346](/assets/20220701_095346.png)

위 파일이 받아지고 실행시킨다.

가상 컴퓨터 접속하려면 id,pw 넣고 아까 저장한 파일 (키 페어 파일)을 열면 암호가 나온다.

![20220701_095525](/assets/20220701_095525.png)

실행하고 연결을 하게 되면 사용자 자격 증명 입력 어쩌구 하면서 암호 화면이 나오게 된다.


----

![20220701_100137](/assets/20220701_100137.png)

그리고 아까 화면에서 아래 보면 암호와 암호 가져오기 버튼이 있다.


![20220701_100204](/assets/20220701_100204.png)

![20220701_100258](/assets/20220701_100258.png)

암호 가져오기 버튼에서 Browse버튼을 누르고 이전에 받아둔 key.pem파일을 넣는다. 그리고 암호 해독 버튼 실행



![20220701_100344](/assets/20220701_100344.png)

인스턴스 연결 화면이 나오게 된다.

<br>


----

<br>
![20220701_095525](/assets/20220701_095525_q7vg5ehtf.png)

그리고 아까 화면에서

![20220701_100623](/assets/20220701_100623.png)

인스턴스 연결 화면에서 밑에 암호를 복사한 뒤

(참고로 암호 복사 할 때 암호 부분을 긁어서 복사하면 안 먹는다. 옆에 암호 복사 클릭할 수 있는 부분을 클릭해야 복사한 뒤 저 암호 박스에 넣어야 정상 작동이 가능하다.)


![20220701_100903](/assets/20220701_100903.png)


------

![20220701_101539](/assets/20220701_101539.png)

암호를 잘 복사해서 넣어주고 실행하게 되면,

위와 같은 화면으로 가게 된다. 실행해주자.


----

<br>
참고로 위 설정은 맥이든 윈도우든 어디서 하든 상관이 없다.

맥 윈도우 어디서 하냐 설정 차이 일 뿐 결국 AWS EC2라는 원격 컴퓨터에 접속하기 때문에 어디서 하든 설정은 같다.

<br>
----
<br>

##### AWS 윈도우 프리티어는 IE가 안 먹는다?


IE 가 22년 6월부로 사형선고를 받았다.

그래서 그런지 AWS 윈도우 서버에서 깃허브를 로그인 하고 들어가려니까

![20220701_105738](/assets/20220701_105738.png)

id, pw를 입력해도 아래와 같은 에러가 계속 나왔다.

그래서 크롬을 다운 받으려는데

![20220701_110202](/assets/20220701_110202.png)

크롬 다운 받는 란 마저 헤더 부분 말고 아무 것도 안뜨더라

그래서 다른 분들께 물어본 결과 그냥 로컬에서 ctrl + cv를 하면 된다길래 주소창을 복사해봤지만
주소창 복사하고 넣어도 똑같길래 또 다른분이 setup.exe를 cv하면 된다서 해봤는데

![20220701_111113](/assets/20220701_111113.png)

진짜로 setup.exe파일이 복사가 되더라.. 이거 뭐야..
하나 알아갑니다.


<br>
-----


해당 윈도우 AWS에 들어오면 앞서 톰캣과 jdk 설치해야한다.

![20220701_140100](/assets/20220701_140100.png)

![20220701_140130](/assets/20220701_140130.png)

tomcat9와 openjdk 1.8을 해당 서버 컴퓨터에 띄워서 들어가서 받아준다.


그리고 환경변수로 들어가 준다.

<br>

-----

![20220701_142623](/assets/20220701_142623.png)



![20220701_143226](/assets/20220701_143226.png)

똑같이 영어긴 하지만 로컬 윈도우에서 했듯이
path 설정과 javaHome을 추가해준다.


<br>


-----------------

![20220701_162902](/assets/20220701_162902.png)


톰캣도 마찬가지로 C드라이브에 옮기고 실행해준다(startup.sh)


![20220701_163245](/assets/20220701_163245.png)

그렇게 되면 localhost:8080접속시 톰캣 화면이 잘 작동하게 된다.


<br>

-----


![20220701_163353](/assets/20220701_163353.png)

검색창 firewall을 입력해주고 왼 쪽 Advanced Setting을 실행해준다.


![20220701_164207](/assets/20220701_164207.png)

![20220701_164909](/assets/20220701_164909.png)

안에 가서 Inbound rules 선택

<br>

----

![20220701_165239](/assets/20220701_165239.png)

New rules 선택(Inbound는 방화벽 안 Outbound는 방화벽 밖)



![20220701_170754](/assets/20220701_170754.png)
여기서 program이 디폴트로 되어있을 텐데 port로 바꾸고 다음으로 간다.

![20220701_165422](/assets/20220701_165422.png)

 관련 설정 해줄텐데 8080 해주고 실행하면 된다.


<br>

------

안에 들어가서 보안 설정으로 간다.

![20220701_165952](/assets/20220701_165952.png)

그리고 아래 인바운드 규칙/ 아웃바운드 규칙이 있는데 아웃바운드 규칙으로 간다.


그리고 안에서 유형을 모든 TCP 로 변경한다.

<br>

-----


![20220701_170142](/assets/20220701_170142.png)


참고로 아웃바인드였는데 인바운드 규칙 편집해야 한다

![20220701_171813](/assets/20220701_171813.png)

설정하고 실행해보면 해당 public 주소를 넣고 뒤에 포트번호를 넣고 주소창에서 실행해보면

![20220701_172728](/assets/20220701_172728.png)

나오게 된다.

<br>
---

그리고 배포하기 위해 sts3에서 war을 만들어주자

![20220702_141353](/assets/20220702_141353.png)

(참고로 sts3는 마켓플레이스나 run메뉴에서 war로 바로 export하는 메뉴가 없다. 그래서 maven install, maven build를 실행하고 .m2파일 안에 war파일을 만들어야 한다.)

<br>

---


그리고 인스턴스를 실행해준다.

#### 인스턴스 안 쓰면 중지 시켜두자. (그래야 시간이 줄어들지 않는다고 한다.)


인스턴스 화면에서 연결 선택

![20220702_143500](/assets/20220702_143500.png)


그리고 안에 원격 데스크탑 가서 선택

![20220702_144347](/assets/20220702_144347.png)

그럼 위에서 했던거 처럼 rdp파일을 준다.

안에 pem 비밀번호 입력.(rdp 실행해서 암호 넣는게 아니라 아래 암호 가져오기를 통해 암호를 넣는다.)

![20220702_144528](/assets/20220702_144528.png)

그리고 위에서 했던대로 암호 해독하고 실행.

로컬에서 만든 C드라이브를 가상 컴퓨터 안의 톰캣 폴더 안의 webapp에 넣어준다.

![20220702_145715](/assets/20220702_145715.png)

넣어두면 톰캣이 자동으로 실행되며 압축이 풀린다.
(혹시 안되면 bin 폴더가서 startup.sh 실행)

![20220702_150000](/assets/20220702_150000.png)

그리고  실행 후 로컬로 돌아와서 AWS에 있는 퍼블릭 주소를 복사해서 주소창에 가서 실행해보면 잘 돌아가는 걸 볼 수 있다.
