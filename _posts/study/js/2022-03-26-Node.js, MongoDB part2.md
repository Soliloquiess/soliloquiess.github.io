---
title: "[js] Node js & MongoDB part2"
layout: post
subtitle: JS
date: "2021-09-10-23:45:51 +0900"

categories: study
tags: JS
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---


### MongoDB 셋팅하기

★ 참고사항 :

접속 URL 복붙하실 때 mongodb+srv://디비계정아이디:디비계정패스워드@cluster0-qaxa3.mongodb.net/데이터베이스이름?retryWrites=true&w=majority

이거 3개를 잘 입력해야합니다.


MongoDB Atlas 가입/초기셋팅 방법


1. 구글에 Mongodb atlas 라고 검색해서 홈페이지를 방문합니다 .



2. 가입합니다. 아마 메일인증 필요





▼ 3. 뭐 채우라고 하면 잘 채워봅니다 (나중에 변경가능)

![20220405_153322](/assets/20220405_153322.png)

▼ 4. 무료 티어를 선택합니다

![20220406_124615](/assets/20220406_124615.png)

▼ 5. 서버위치를 선택합니다. 한국과 물리적으로 가장 가까운 곳을 골라줍니다.

그 밑 내용들은 아마 안건드려도 될듯요 그리고 계속 진행하면 Cluster가 생성됩니다.

![20220406_124730](/assets/20220406_124730.png)



▼ 6. Database Access 메뉴에서 DB 접속용 아이디/비번을 생성합니다.

데이터베이스 접속할 수 있는 아이디/비번을 새로 만들어주는겁니다.

왜냐면 하나의 데이터베이스를 여러사람이 사용할 수도 있으니까요.  

아주 안전해보이는 admin/qwer1234 이런 아이디 비번은 어떨까요 아무튼 만들고 잘 기억해두십시오.

![20220406_124759](/assets/20220406_124759.png)

![20220406_124814](/assets/20220406_124814.png)


▼7. Network Access 메뉴에서 IP를 추가합니다.

데이터베이스 접속할 수 있는 IP를 미리 정의해놓는 일종의 보안장치입니다.

스타벅스에서 코딩하실게 분명하니 Allow access from anywhere을 누르시거나 0.0.0.0/0 을 추가합니다.

![20220406_124839](/assets/20220406_124839.png)

![20220406_124847](/assets/20220406_124847.png)

▼8. Database / collection 만들기를 진행합니다.

Cluster는 하나의 호스팅 공간이고

거기 안에 여러분의 데이터베이스를 만들어야 데이터를 저장할 수 있습니다.

다음시간에 할 것이긴 한데 아무튼 먼저 합시다.

![20220406_124920](/assets/20220406_124920.png)

![20220406_124941](/assets/20220406_124941.png)

![20220406_124948](/assets/20220406_124948.png)
▲ 데이터베이스 이름을 맘대로 설정해주면 됩니다.

저는 이렇게 했는데 이러면 todoapp 이라는 이름의 데이터베이스가 하나 생성됩니다.

이제 이 데이터베이스를 여러분의 컴퓨터에서 접속하려면

강의에서 설명하는 접속 url을 여러분 코드에 복붙해주면 됩니다.

접속 url엔 여러분의 디비 접속용 아이디/비번/데이터베이스 이름이 들어가야합니다.

-----

###  Database라고 부르는 것이 있습니다.

그냥 데이터를 일정한 형식으로 저장할 수 있게 도와주는 곳이라고 보시면 되겠습니다.

가장 쉽게볼 수 있는게 바로 엑셀입니다.

엑셀에선 시트를 하나 만드신 후 행과 열에 원하는 데이터를 기입하면 자료 저장 끝이죠?

데이터베이스도 동일합니다.

하지만 데이터베이스는 간지나는 SQL이라는 언어를 써서 데이터를 입력, 출력합니다.




 ![20220406_141128](/assets/20220406_141128.png)

 대문자로 쓰는 이상한 언어입니다.

하지만 이걸 또 배우고 그럴 시간이 없기 때문에 우린 NoSQL이라는

SQL언어를 쓰지 않고도 쓸 수 있는 쉬운 DB를 배워보도록 합시다.



그 중 MongoDB라는 것을 사용할 것인데 그 이유는..

- 처음 다룰 때 어려운 셋팅작업이 필요하지 않음 (스키마 생성 등 필요없음)

- SQL 안배워도 됨

- 복잡한 자료형 몰라도 됨

- 평생 무료 호스팅해주는 곳이 있음

그리고 DB의 종류에 대해서도 할말이 많은데 그건 다음 강의에서 알아보도록 합시다.











MongoDB Atlas 가입 후 호스팅받기



DB를 여러분 집 컴퓨터에 설치하기도 하지만 사이트를 실제 배포할 것이라면 클라우드 서비스를 이용하는 것이 매우 안전합니다.

백업도 알아서 해주고 갑자기 사람이 터질 때 용량 걱정도 없고

그리고 무엇보다 접속 속도가 빠릅니다.

근데 이걸 무료로 호스팅 해주는 고마운 MongoDB Atlas라는 사이트가 하나 있습니다.













#### DB 접속하는 URL 찾아오기



server.js에서 DB에 접속하려면 접속 방법을 알아야겠죠?



1. 메인화면 셋팅이 끝나면 CONNECT라는 작은 흰색 버튼 누르기

2. 가운데 Connect Your Application 버튼 누르기

3. (1) Choose your driver version 에서 Node.js 선택되어있는지 잘 확인하기

3. (2) 밑에 접속 URL(Connection String) 긴게 뜨면 복사해서 일단 메모장 같은 곳에 저장해놓기



끝입니다. 이거 접속 URL만 잘 써주시면 이제 Node.js로 돌아가는 파일에서 여러분 DB와 직접 통신이 가능합니다.



Server.js에서 DB접속하려면



1. 터미널 켜서 npm install mongodb 를 입력해서 라이브러리를 설치합니다.

그냥 MongoDB 접속을 쉽게 도와주는 라이브러리입니다.

뭔가 에러가 나고 안된다면 npm uninstall mongodb 로 지웠다가

npm install mongodb@3.6.4 이렇게 설치해서 이용해보도록 합시다.



2. server.js 상단 쯤에 다음 코드를 추가합니다.

const MongoClient = require('mongodb').MongoClient;
require 라는 글자 많은 곳에 함께 위치시켜 주면 될듯 합니다.





3. 하단에 다음 코드를 입력해줍니다.
```
 MongoClient.connect('아까 챙겨온 접속URL', function(에러, client){
  if (에러) return console.log(에러);
  //서버띄우는 코드 여기로 옮기기
  app.listen('8080', function(){
    console.log('listening on 8080')
  });
})
```
접속 URL은 대충 이렇게 생겼는데

mongodb+srv://디비계정아이디:디비계정패스워드@cluster0-qaxa3.mongodb.net/데이터베이스이름?retryWrites=true&w=majority

빨간 부분 3개를 여러분이 만든걸로 잘 채워 입력해야합니다.

그리고 app.listen이라고 그 서버 띄우는 코드를 여기 안으로 옮겨주시면 되겠습니다.

그리고 터미널에서 nodemon server.js로 서버를 실행시켜보면 터미널에 listening on 8080이라고 잘 뜨죠?

아무튼 뜨면 성공입니다.

warning 이런게 뜨는건 상관없는데 에러 등이 뜨거나 listening on 8080 글자가 안뜬다면

1. 접속 URL 양끝에 따옴표 잘있는지 확인하시고

2. URL 안에 아이디 비번란에 Atlas 계정이 아니라 Database Access 메뉴에서 만든 DB 계정 넣었는지 다시 확인하시고

3. URL 내에 비번 입력시 특수문자를 넣어야하시면 (참고) 하십시오. 귀찮으면 계정만들 때 특수문자를 넣지마세요.

4. Network Access 메뉴에서 허용한 IP에서 접속하고 있는지

5. app. listen 코드를 저기로 옮긴거 맞습니까

6. 나머지는 오타입니다













또 오타났을까봐 server.js 윗부분 전체 코드

```
server.js
const express = require('express')
app.use(express.urlencoded({ extended: true }));
const app = express()
const MongoClient = require('mongodb').MongoClient


MongoClient.connect('님 접속 URL', function(에러, client){
  if (에러) return console.log(에러)
  app.listen(8080, function() {
    console.log('listening on 8080')
  })
})

//여기 이하는 쓸데없는 app.get 이런 코드들

app.get('/', function(요청, 응답) {
  응답.sendFile(__dirname +'/index.html')
})

```

---------

### Database에 자료 저장하는 법 (한줄이면 끝)
