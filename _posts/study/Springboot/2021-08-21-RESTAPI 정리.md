---
title: "[Springboot] REST API 정리"
layout: post
subtitle: Springboot
date: "2021-08-21-14:58:53 +0900"
categories: study
tags: Springboot
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---

### 스프링 MVC 구조

- 스프링 MVC는 DispatcherServlet, View Resolver, Handler, View 등으로 구성되어 있다.

스프링 요청처리 흐름도
![20210821_022001](/assets/20210821_022001.png)

1. 클라이언트( 브라우저) 의 요청을 DispatcherServlet이 받는다.

2. 받은 요청을 처리할 수 있는 Handler 의 이름을 HandlerMapping에게 물어본다.

3. HandlerMapping은 요청 URL을 비롯한 여러 요청정보를 가지고 Handler를 판단한다.
4. DispatcherServlet은 HandlerMapping으로부터 선택받은 Handler에게 요청을 보낸다.

5. Handler는 요청을 적절히 처리하고 응답에서 렌더링 해야하는 ViewName을 판단해서 DispatcherServlet에 전송한다.

6. DispatcherServlet은 논리적인 ViewName을 ViewResolver에 전달한다.

7. ViewResolver는 응답에 필요한 View를 생성하여 DispatcherServlet에 보낸다.

8. DispatcherServlet은 해당하는 View에 Model을 전달한다.

9. View는 Model을 참조해서 응답을 생성한다.

10. DispatcherServlet는 생성된 응답을 클라이언트(브라우저)에 반환한다.

---

### 자바 빈즈

자바빈즈(JavaBeans)는 자바로 작성된 소프트웨어 컴포넌트이다.

자바빈즈의 사양은 썬 마이크로시스템즈에서 다음과 같이 정의되었다.

"빌더 형식의 개발도구에서 가시적으로 조작이 가능하고 또한 재사용이 가능한 소프트웨어 컴포넌트이다."

자바빈즈는 많은 측면에서 유사하지만 엔터프라이즈 자바빈즈 (EJB)와 혼동하지 말아야 한다. EJB는 자바 플랫폼, 엔터프라이즈 에디션 (Java EE)의 일부로서 서버계열의 컴포넌트이다.

##### 자바 빈즈의 관례

- 자바 빈즈 클래스로서 작동하기 위해서, 객체 클래스는 명명법, 생성법 그리고 행동에 관련된 일련의 관례를 따라야만 한다.

이러한 관례는 (빌더형식의) 개발도구에서 자바 빈즈와의 연결을 통해 클래스의 사용과 재사용 그리고 클래스의 재배치를 가능하게 한다.

지켜야 할 관례에는 다음과 같은 것이 있다.

1. 클래스는 직렬화 되어야 한다(클래스의 상태를 지속적으로 저장 혹은 복원시키기 위해)

2. 클래스 기본 생성자를 가지고 있어야 한다.
3. 클래스의 속성들은 get, set 혹은 표준 명명법을 따르는 메서드들을 사용해 접근할 수 있어야 한다.

4. 클래스는 필요한 이벤트 처리 메서드들을 포함하고 있어야 한다.

---

##### 자바 빈즈의 직렬화

- 자바 빈즈는 반드시 직렬화 할 필요는 없으나 미리 구현해 두는 것이 무난하다.

본서에서는 편의상 직렬화는 반드시 구현해야 하는 경우가 아니면 구현하지 않는다.

직렬화가 필요한 경우는 다음과 같다.

1. JPA 프로바이더 제공하는 캐시기술이 Serializable 인터페이스를 요구하는 경우

2. 자바 빈즈 객체를 스코프에서 관리하는 경우

3. 다수의 서버에서 세션 객체를 공유해야 하는 경우

---

### 롬복 어노테이션

- 롬복(Lombok) 을 활용하면 약간의 애너테이션 설정만으로 소스 코드가 컴파일 될때 자동으로 추가 코드를 만들 수 있다.

- 롬복 어노테이션의

| 어노테이션              | 설명                                                                                                           |
| ----------------------- | -------------------------------------------------------------------------------------------------------------- |
| @Getter/@Setter         | 객체의 게터와 세터를 생성한다.                                                                                 |
| @ToString               | toString() 메서드를 생성한다.                                                                                  |
| @EqualsAndHashCode      | 자바의 equals() 메서드와 hashCode()메서드를 생성한다.                                                          |
| @NoArgsConstructor      | 인자가 없는 기본 생성자를 생성한다.                                                                            |
| @RequiredArgsConstuctor | @NonNull이 적용된 필드 값이나 final로 선언된 필드값만 인자로 받는 생성자를 생성한다.                           |
| @AllArgsConstructor     | 객체의 모든 필드값을 인자로 받는 생성자를 생성한다.                                                            |
| @Data                   | @ToString, @Getter, @Setter, @EqualsAndHashCode, @RequiredArgsConstuctor 어노테이션을 합쳐노은 어노테이션이다. |
| @Builder                | 빌더 패턴을 사용할 수 있도록 코드를 생성한다.                                                                  |
| @Log(Slf4j)             | 자동으로 생기는 log라는 변수를 이용해서 로그를 출력할 수 있다.                                                 |

---

### REST 소개

REST(Representational State Transfer)는 월드 와이드 웹과 같은 분산 하이퍼 미디어 시스템을 위한 소프트웨어 아키텍쳐의 한 형식이다.

엄격한 의미로 REST는 네트워크 아키텍쳐 원리의 모음이다. 여기서 "네트워크 아키텍쳐""란 자원을 정의하고 자원에 대한 주소를 지정하는 방법 전반을 일컫는다.

간단한 의미로는 웹상의 자료를 HTTP위에서 SOAP이나 쿠키를 통한 세션 트랙킹 같은 별도의 전송 계층 없이 전송하기 위한 아주 간단한 인터페이스를 말한다.

REST 아키텍쳐 형식을 따르면 HTTP나 WWW이 아닌 아주 커다란 소프트웨어 시스템을 설계도 가능하다.

또한 리모트 프로시저 콜 대신 간단한 XMㅣ과 HTTP 인터페이스를 이용해 설계하는 것 또한 가능하다.

### RESTFUL 제약조건

REST 제약조건들을 제대로 지키면서 REST아키텍쳐를 만드는 것을 RESTful이라고 한다.

다음 제약 조건들을 준수하는 한 개별 컴포넌트들을 자유로이 구현할 수 있다.

- 클라이언트-서버 구조: 일관적인 인터페이스로 분리되어야 한다.

- 무상태성(stateless): 서버에 클라이언트의 상태정보를 저장하지 않는다.

- 캐시기능(cacheable): 클라이언트의 응답을 캐시할 수 있어야 하며, 캐싱은 클라이언트-서버간 상호작용을 부분적으로 또는 완전하게 제거하여 scalability와 성능을 향상시킨다.

- 계층화 시스템(layered system)
  : 중간서버는 로드밸런싱 기능이나 공유캐시기능을 제공함으로서 확장성 있는 시스템을 구성하는데 유용하다

- 코드 온 디맨드(code on demand)
  : 서버가 자바 애플릿이나 자바스크립트 실행코드의 제공을 통해 클라이언트가 실행시킬수 있는 로직을 전송하여 기능을 확장시킬 수 있다.

- 인터페이스 일관성(uniform interface)
  : 아키텍처를 단순화 시키고 작은 단위로 분리함으로써 클라이언트- 서버 각 파트가 독립적으로 개선되게 해준다.

### REST 인터페이스 원칙에 대한 가이드

가이드를 충실히 이행했는지에 따라 REST를 제대로 썼는지 판단할 수 있다.

1. 자원식별
   : 요청 내의 기술된 개별자원을 식별할 수 있어야 한다. 웹 기반의 REST 시스템에서의 URI 사용을 예로 들 수 있다.

2. 메시지 통한 리소스 조작
   : 클라이언트가 어떤 자원을 지칭하는 메시지와 특정 메타데이터만 가지고 있다면 이것으로 서버상의 해당 자원을 수정, 삭제하는 충분한 정보를 갖고 있다고 볼 수 있다.

3. 자기 서술적 메시지
   : 각 메시지에는 처리방법에 대한 충분한 정보가 들어있어야 한다.

4. 애플리케이션 상태에 대한 엔진으로서의 하이퍼미디어(HATEOAS)
   : 클라이언트에 응답할 떄 단순히 결과 데이터만을 제공하는 것이 아니라 URI를 함꼐 제공해야한다는 것이다.

-------

### REST API 설계

- 서버 한대가 여러 클라이언트에 대응하려면 REST API가 필요하다.

#### REST API의 구성

- 자원(resource) : URI
- 행위(verb) : HTTP 메서드
- 표현(representations): 리소스에 대한 표현(HTTP MESSAGE BODY)

#### URI 설계

- 리소스는 서비스를 제공하는 시스템의 자원을 의미하며 URI로 정의된다.

URI는 웹에 있는 자원의 이름과 위치를 식별한다.


#### 명사를 사용하라.

URI 는 명사를 사용해야하며 동사는 피해야한다.
명사만으로는 세부적인 동작을 표현하는데 한계가 있을 떄 동사를 URI에 포함 할 수 있다.

#### 동사는 HTTP 메서드로 표현한다.

- 동사를 표현할 떄는 HTTP 메서드인 GET, POST, PUT, DELETE 등으로 대체해야한다.

#### 복수형을 사용하라.

- URI에서는 명사에 단수형보다는 복수형을 사용해야한다.

/book도 물론 명사고 사용 가능하지만 /books 로 리소스를 표현하려면 컬렉션(collection)으로 명확히 표현할 수 있어 확장성 측면에서 유리하다.

#### 슬래시로 계층 관계를 표현한다.

#### URI의 마지막에 슬래시를 넣지 않는다.
- 넣어도 문제는 없지만 다음 계층이 있다는 오해를 부를 수 있다.

#### URI는 소문자로 작성한다.


![20210821_190845](/assets/20210821_190845.png)


---------


### 제이슨 소개

- 제이슨은 영문표기로 JSON(JavaScript Object Notation)이라 하며, 플랫폼이나 언어와 무관하게 자바스크립트 내 자료교환을 목적으로 만들어진 포맷이다.

#### REST 서버에서 제공하는 자원의 타입중 XML 보다 제이슨을 더 선호하는 이유

- 제이슨은 표현의 완전성과 가독성 좋을 뿐 아니라 자바스크립트의 기본형식이다.
- 제이슨은 XML 보다 표현이 간단하다. 또한 제이슨은 XML 스키마나 XML DTD에 대한 구분이 필요없다.




#### 제이슨의 문법

- 제이슨은 바이너리(binary)코드가 아닌 무자로만 이루어져있다.
- 문자의 인코딩은 유니코드이다.
- 제이슨의 마임타입(MIME) 은 'application/json'이다.
- 제이슨은 시작'{' 중괄호로 시작하고 마무리 중괄호로 끝난다.'}'
- 콤마는 두개의 제이슨 또는 제이슨 값을 구분하는 구분자로 사용한다.
- 키와 값의 구분은 . 를 사이에 두고 하는데 만약 일반 문자열을 읽고 해석할 떄는 '='또는 '=>'도 같은 무구분자로 인식한다.
- 제이슨 키와 문자열 타입의 값은 "" 큰 따옴표를 사용하여 표기한다.
- 값으로 들어가는 자료타입은 숫자를 표현한 문자(int, long, double), 문자열(string), 불린(boolean), 제이슨 배열(JSONARRAY), 제이슨 객체가 된다.


#### JSON자료타입

- JSON은 2개의 구조를 기본으로 가지고 있다.

- name/value 형태의 쌍으로 컬렉션타입, 다양한 언어에서 이는 object, record, struct(구조체), dictionary, hashtable, 키가 있는 list, 또는 연상배열에서 실현되었다.

###### Object

- object는 name/value 쌍들의 비순서화된 set이다. object는 좌중괄호로 시작하고 우중괄호로 끝내어 표현한다.
각 name 뒤에 : 콜론을 붙이고, 콤마로 name/value쌍들 간을 구분한다.

![20210821_195713](/assets/20210821_195713.png)

###### array
- array는 값들의 순서화된 컬렉션이다.

![20210821_195741](/assets/20210821_195741.png)


###### value

- value 는 큰 따옴표 안에 string, number, true, false, null, object ,array등이 올 수 있다. 이러한 구조들을 포함한다.

![20210821_195841](/assets/20210821_195841.png)

###### String
- 큰 따옴표 안에 둘러싸인 zero이상 unicode 문자들의 조합이며, 쌍따옴표 안에 감싸지며 백슬래쉬 이스케이프가 적용된다. 하나의 문자도 하나의 문자열로서 표현된다.

![20210821_195907](/assets/20210821_195907.png)



-----

### JQUERY Ajax 통신


1. $.get()

- Http Get 요청을 사용하여 서버에서 데이터를 로드한다.

$.get(Uril, parameters, callback)

매개변수로 명시된 URL을 사용하여 서버에 대한 GET요청을 전송한다. 매개변수는 쿼리 문자열로 전달한다.

- 매개변수

| 변수명           | 타입 | 설명  |
| ----------------------- | ------------| -------------------------------------------------------------------------------------------------- |
| URL  | String   | GET 메서드로 연결하는 서버측 자원의 URL
| parameter  | Object, String   | URL에 덧붙이는 쿼리문자열을 구성하려고 이름과 값의 쌍으로 프로퍼티를 지닌 객체, 미리 구성 및 인코딩 된 쿼리 문자열
| callback  | Function | 요청이 완료되면 호출되는 함수. 응답 본문은 이 콜백 함수의 첫번째 매개변수로 전달되며 상태값은 두번째 매개변수로 전달된다.


반환값 : XHR 인스턴스

-----



2. $.getJson()

- Http Get 요청을 사용하여 서버에서 JSON 형식으로 인코딩 된 데이터를 로드한다.

$.getJSON(Uril, parameters, callback)

매개변수로 명시된 URL을 사용하여 서버에 대한 GET요청을 전송한다. 매개변수는 쿼리 문자열로 전달한다. 응답은 JSON문자열로 해석되며, 결과로 만들어진 데이터는 콜백함수에 전달된다.

- 매개변수

| 변수명           | 타입 | 설명  |
| ----------------------- | ------------| -------------------------------------------------------------------------------------------------- |
| URL  | String   | GET 메서드로 연결하는 서버측 자원의 URL
| parameter  | Object, String   | URL에 덧붙이는 쿼리문자열을 구성하려고 이름과 값의 쌍으로 프로퍼티를 지닌 객체, 미리 구성 및 인코딩 된 쿼리 문자열
| callback  | Function | 요청이 완료되면 호출되는 함수. 응답 본문은 이 콜백 함수의 첫번째 매개변수로 전달되며 상태값은 두번째 매개변수로 전달된다.


반환값 : XHR 인스턴스


-----------


3. $.post()
- HTTP POST 요청을 사용하여 서버에서 데이터를 로드한다.

$.post(url, parameters, callback)


| 변수명           | 타입 | 설명  |
| ----------------------- | ------------| -------------------------------------------------------------------------------------------------- |
| URL  | String   | GET 메서드로 연결하는 서버측 자원의 URL
| parameter  | Object, String   | URL에 덧붙이는 쿼리문자열을 구성하려고 이름과 값의 쌍으로 프로퍼티를 지닌 객체, 미리 구성 및 인코딩 된 쿼리 문자열
| callback  | Function | 요청이 완료되면 호출되는 함수. 응답 본문은 이 콜백 함수의 첫번째 매개변수로 전달되며 상태값은 두번째 매개변수로 전달된다.


4. $.ajax()
- 비동기 HTTP (Ajax) 요청을 수행한다.
- $.ajax(options)
요청의 생성방법 과 통보 받을 콜백을 제어하고자 전달된 options를 사용하여 Ajax요청을 전송한다.

매개변수

| 변수명           | 타입 | 설명  |
| ----------------------- | ------------| -------------------------------------------------------------------------------------------------- |
| option  | object   | 요청에 대한 매개변수를 정의하는 프로퍼티를 소유한 객체 인스턴스

- 반환값 : XHR 인스턴스


함수의 옵션

| 변수명           | 타입 | 설명  |
| ----------------------- | ------------| -------------------------------------------------------------------------------------------------- |
| url  | String   | 요청 URL
| type  | String   | 사용할 HTTP 메서드, 일반적으로 POST나 GET을 사용한다. 생략하면 기본값으로 GET을 사용한다.
| data  | Object   | 요청에 전달되는 프로퍼티를 가진 객체. GET요청이면 데이터는 쿼리 문자열로 제공된다.POST 요청이면 데이터는 요청의 본문으로 제공된다.
| datatype  | String   | 응답의 결과로 반환되는 데이터의 종류를 식별하는 키워드. 유효한 xml, html, json, jsonp, script, text이다.
| timeout  | Number   | Ajax의 요청제한 시간을 밀리초 단위로 설정한다.
| global  | Boolean   | true나 false냐에 따라 전역함수를 활성화 하거나 비활성화 한다.
| content | String   | 요청에 명시되는 타입 생략하면 'application'/ x-www-form-urlencoded' 가 기본값으로 설정된다.
| headers | Object   | 요청헤더 XMLHttpRequest 전송을 사용하여 요청과 함꼐 추가로 전송할 헤더키/ 값 쌍의 객체
| success | Function   | 응답이 성공상태의 코드를 반환하면 호출되는 함수. 응답 본문은 이 함수의 첫번째 매개변수로 전달되며, dataType 프로퍼티에 명시한 형태로 구성된다. 두번째 매개변수는 상태값을 나타내는 문자열이며, 이번 경우에는 항상 'success'이다.
| error | Function  | 응답이 에러상태의 코드를 반환하면 호출되는 함수. 매개변수가 세개 전달되는데, 각각 XHR인스턴스, 상태값이 항상 'error' 인 메시지 문자열, 선택사항으로 XHR인스턴스가 반환되는 예외객체이다.
| complete | Function   | 요청이 완료되면 호출되는 함수, 매개변수 두개가 전달되는데 각각 XHR인스턴스와 success또는 error 를 나타내는 상태 메시지 문자열이다. success 나 error 콜백을 명시했다면, 이 함수는 해당 콜백이 호출된 후에 실행된다.
| beforeSend | Function   | 요청이 전송되기에 앞서 먼저 호출되는 함수, 이 함수는 XHR 인스턴스를 전달받으며 사용자 정의헤더를 설정하거나 요청 전에 필요한 연산을 수행하는 데 사용할 수 있다.
| async | Boolean   | 요청이 전송되기에 앞서 먼저 호출되는 함수, 이 함수는 XHR 인스턴스를 전달받으며 사용자 정의헤더를 설정하거나 요청 전에 필요한 연산을 수행하는 데 사용할 수 있다.
| ProcessData | Boolean   | 요청이 전송되기에 앞서 먼저 호출되는 함수, 이 함수는 XHR 인스턴스를 전달받으며 사용자 정의헤더를 설정하거나 요청 전에 필요한 연산을 수행하는 데 사용할 수 있다.
| ifModified | Boolean   | true일때 Last-Modified 헤더를 확인하며 마지막 요청 이후에 응답 컨텐츠가 변경되지 않았다면 요청이 성공한다. 만일 생략하면 헤더를 확인하지 않는다.

-----



### 컨트롤러 메서드 매개변수

##### 주요 매개 변수

- Model : 이동 대상 에 전달할 데이터를 가지고 있는 인터페이스.
- RedirectAttributes : 리다이렉트 대상에 전달할 데이터를 가지고 있는 인터페이스
- 자바 빈즈 클래스 : 요청 파라미터 가지고 있는 자바빈즈 클래스
- MultipartFile : 멀티파트 요청을 사용해 업로드 된 파일 정보를 가지고 있는 인터페이스
- BindingResult : 도메인 클래스의 입력값 검증 결과 가지고 있는 인터페이스
- Java.util.Locale: 클라이언트 로캘
- java.security.Principal : 클라이언트 인증을 위한 사용자 정보를 가지고 있는 인터페이스.

##### 요청 데이터 처리 어노테이션

- @PathVariable : URL 에서 경로변수 값을 가져오기 위한 어노테이션
- @RequestParam : 요청 파라미터 값을 가져오기 위한 어노테이션
- @RequestHeader : 요청 헤더 값을 가져오기 위한 어노테이션.
- @RequestBody : 요청 본문 내용을 가져오기 위한 어노테이션
- @CookieValue : 쿠키 값을 가져오기 위한 어노테이션.


----

### 입력값 검증

- 스프링 MVC는 Bean Validation기능을 이용해 요청 파라미터 값이 바인딩 된 도메인 클래스(또는 커맨드 클래스)의 입력값을 검증한다.

##### 입력값 검증 활성화

- 입력값 검증을 하기 위해서는 메서드 매개변수에 도메인 클래스를 정의하고  @Validated를 지정한다.
- 입력값 검증 대상의 도메인 클래스 직후에 BindingResult를 정의한다. BindingResult에는 요청 데이터의 바인딩 오류와 입력값 검증 오류정보가 저장된다.

###### Validated 어노테이션을 지정하여 입력값 검증 기능을 활성화한다.
