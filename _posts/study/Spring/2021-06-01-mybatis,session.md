---
title: "[Spring] MVC mybatis, session"
layout: post
subtitle: Spring
date: "2021-06-01-02:58:53 +0900"

categories: study
tags: Spring
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---


mybatis는 jdbc로 수정하면 일일이 수정하면 유지보수하는데 어려움을 겪는다.

그리고 모든 쿼리 작성 이런걸 개발자가 작성해야되서 개발 속도가 되게 느리다.


그걸 해결해주는게 mybatis


![20210601_022843](/assets/20210601_022843.png)


그리고 mybatis를 사용하면 dao에 있던걸 properties 파일에 넣게 된다.

![20210601_022930](/assets/20210601_022930.png)

![20210601_022945](/assets/20210601_022945.png)

이처럼 프로퍼티 파일로 관리하게 된다.


그리고 sql파일은 매퍼파일(xml)에 저장하게 된다.

![20210601_030823](/assets/20210601_030823.png)

이 3개가 있어야 db접속이 된다.


-------


#### 커넥션 풀

![20210601_035918](/assets/20210601_035918.png)

프로퍼티스와 sql 저장한 매퍼파일을 XML 환경설정 파일로 묶는다.



![20210601_040430](/assets/20210601_040430.png)
여기가 디비 연결하기 위한 데이터 소스 넣는 곳이다.


![20210601_043420](/assets/20210601_043420.png)

자바와 디비 연결하기 위해서는 커넥션이 필요하다.

프로젝트에서 부하가 많이 걸리는 부분이 커넥션 부분(이것저것 확인해야 하므로 로그인이라던가 디비 정보라던가 등등.)

그리고 커넥션을 종료시킨다.(다 끝나면)

근데 mybatis는 이 커넥션을 없애지 않는다.

즉 재활용 하자는게 mybatis의 취지.

커넥션 풀 메모리에다가 미리 커넥션을 만들어둔다.(여러개를 메모리에 만들어 둠.)


미리 만들어 둔걸 커넥션 풀이라 한다.

만약 자바에서 디비 작업을 하고싶은데(crud)
커넥션에서 꺼내와서 작업하고 커넥션 풀에 반납

다른 사람도 커넥션 쓰고 반납.

![20210601_043746](/assets/20210601_043746.png)

왼쪽의 xml 쭉 해석해서 pooled로 커넥션 만들어서  sql세션에 (팩토리)를 만듬

커넥션 풀을 가리키는 걸 sqlSessionFactory라고 한다.


근데 mybatis는 커넥션을 sqlSession이라 한다.
jdbc는 커넥션이라 하지만 mybatis는 세션이라고 한다.

![20210601_044627](/assets/20210601_044627.png)

연결되어있는 객체들 하나하나들을 sql세션이라고 한다.

그리고 그 세션이 모아져 있는 곳이 팩토리다.

mybatis에서 가장 중요한건 환경설정 파일 읽어서
팩토리에 커넥션 풀을 만들어 이걸 가리키는 sql세션 팩토리를 만들어내는 작업.

그래야 세션을 꺼내와서 디비 작업이 가능하다.

![20210601_044815](/assets/20210601_044815.png)

xml로 부터!

![20210601_124502](/assets/20210601_124502.png)

xml이 sql문을 대신해준다.

그리고 vo타입으로 묶어야 하는데 이걸 resulttype으로 정의한다.


![20210601_130048](/assets/20210601_130048.png)

![20210601_130857](/assets/20210601_130857.png)

왼쪽의 jdbc를 마이바티스로 오른쪽처럼 되게 줄일수가 있다.

------------------


상태유지기법인 세션에 대해

![20210601_173218](/assets/20210601_173218.png)

클라이언트가 인증요청 하면 모델하고 요청해서 성공과 실패경우

이떄 jsp는 request로 id를 빼내서 사용이 가능하다.

이떄는 요청을 의뢰한 페이지만 해서  다른 페이지 B,C는 회원인증페이지를 유지할 수가 없다. 그래서 다른 방법도 사용한다.



![20210601_180521](/assets/20210601_180521.png)

![20210601_184845](/assets/20210601_184845.png)

모든 회원페이지가 상태 인증했는지 안했는지 체크


----------


AJAX (Asynchronous Javascript And XML)
AJAX란, JavaScript의 라이브러리중 하나이며 Asynchronous Javascript And Xml(비동기식 자바스크립트와 xml)의 약자이다. 브라우저가 가지고있는 XMLHttpRequest 객체를 이용해서 전체 페이지를 새로 고치지 않고도 페이지의 일부만을 위한 데이터를 로드하는 기법 이며 JavaScript를 사용한 비동기 통신, 클라이언트와 서버간에 XML 데이터를 주고받는 기술이다.

즉, 쉽게 말하자면 자바스크립트를 통해서 서버에 데이터를 요청하는 것이다.

비동기 방식이란?
비동기 방식은 웹페이지를 리로드하지 않고 데이터를 불러오는 방식이며 Ajax를 통해서 서버에 요청을 한 후 멈추어 있는 것이 아니라 그 프로그램은 계속 돌아간다는 의미를 내포하고 있다.



비동기 방식의 장점
페이지 리로드의 경우 전체 리소스를 다시 불러와야하는데 이미지, 스크립트 , 기타 코드등을 모두 재요청할 경우 불필요한 리소스 낭비가 발생하게 되지만 비동기식 방식을 이용할 경우 필요한 부분만 불러와 사용할 수 있으므로 매우 큰 장점이 있다.

AJAX를 사용 가능하게 만드는 것들
AJAX라는 기술은 여러가지 기술이 혼합적으로 사용되어 이루어진다. 대표적인 예로는 아래와 같은 것들이 있다.

HTML
DOM
JavaScript
XMLHttpRequest
Etc
AJAX로 할 수 있는 것
AJAX라는 네트워크 기술을 이용하여 클라이언트에서 서버로 데이터를 요청하고 그에 대한 결과를 돌려받을 수 있다.

클라이언트란?
서버에서 정보를 가져와서 사용자에게 보여줄 수 있고 사용자와 상호작용할 수 있는 소프트웨어를 일컫는다.
Ex) 웹브라우저, 핸드폰 어플리케이션 등...

서버란?
네트워크 상에서 접근할 수 있는 프로그램으로서 어떤 자료들에 대한 관리나 접근을 제어해주는 프로그램을 말한다. 서버는 일반적으로 사용자가 직접적으로 사용하지 않는다.

AJAX를 사용하는 이유
단순하게 WEB화면에서 무언가 부르거나 데이터를 조회하고 싶을 경우, 페이지 전체를 새로고침하지 않기 위해 사용한다고 볼 수 있다.

기본적으로 HTTP 프로토콜은 클라이언트쪽에서 Request를 보내고 서버쪽에서 Response를 받으면 이어졌던 연결이 끊기게 되어있다. 그래서 화면의 내용을 갱신하기 위해서는 다시 request를 하고 response를 하며 페이지 전체를 갱신하게 된다. 하지만 이렇게 할 경우, 엄청난 자원낭비와 시간낭비를 초래하고 말 것이다.

AJAX는 HTML 페이지 전체가 아닌 일부분만 갱신할 수 있도록 XMLHttpRequest객체를 통해 서버에 request한다. 이 경우, JSON이나 XML형태로 필요한 데이터만 받아 갱신하기 때문에 그만큼의 자원과 시간을 아낄 수 있다.

AJAX의 장단점
1. AJAX의 장점
웹페이지의 속도향상
서버의 처리가 완료될 때까지 기다리지 않고 처리가 가능하다.
서버에서 Data만 전송하면 되므로 전체적인 코딩의 양이 줄어든다.
기존 웹에서는 불가능했던 다양한 UI를 가능하게 해준다. ( Flickr의 경우, 사진의 제목이나 태그를 페이지의 리로드 없이 수정할 수 있다.)
2. AJAX의 단점
히스토리 관리가 되지 않는다.
페이지 이동없는 통신으로 인한 보안상의 문제가 있다.
연속으로 데이터를 요청하면 서버 부하가 증가할 수 있다.
XMLHttpRequest를 통해 통신하는 경우, 사용자에게 아무런 진행 정보가 주어지지 않는다. (요청이 완료되지 않았는데 사용자가 페이지를 떠나거나 오작동할 우려가 발생하게 된다.)
AJAX를 쓸 수 없는 브라우저에 대한 문제 이슈가 있다.
HTTP 클라이언트의 기능이 한정되어 있다.
지원하는 Charset이 한정되어 있다.
Script로 작성되므로 디버깅이 용이하지 않다.
동일-출처 정책으로 인하여 다른 도메인과는 통신이 불가능하다. (Cross-Domain문제)


출처 : https://velog.io/@surim014/AJAX%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80
