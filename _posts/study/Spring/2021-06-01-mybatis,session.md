---
title: "[Spring] MVC mybatis, session"
layout: post
subtitle: Spring
date: "2021-06-01-02:58:53 +0900"

categories: study
tags: Spring
# layout: post
# title:  WebFrontEnd
# subtitle:   "시작하기"
# categories: study
# tags: java
comments: true
---


mybatis는 jdbc로 수정하면 일일이 수정하면 유지보수하는데 어려움을 겪는다.

그리고 모든 쿼리 작성 이런걸 개발자가 작성해야되서 개발 속도가 되게 느리다.


그걸 해결해주는게 mybatis


![20210601_022843](/assets/20210601_022843.png)


그리고 mybatis를 사용하면 dao에 있던걸 properties 파일에 넣게 된다.

![20210601_022930](/assets/20210601_022930.png)

![20210601_022945](/assets/20210601_022945.png)

이처럼 프로퍼티 파일로 관리하게 된다.


그리고 sql파일은 매퍼파일(xml)에 저장하게 된다.

![20210601_030823](/assets/20210601_030823.png)

이 3개가 있어야 db접속이 된다.


-------


#### 커넥션 풀

![20210601_035918](/assets/20210601_035918.png)

프로퍼티스와 sql 저장한 매퍼파일을 XML 환경설정 파일로 묶는다.



![20210601_040430](/assets/20210601_040430.png)
여기가 디비 연결하기 위한 데이터 소스 넣는 곳이다.


![20210601_043420](/assets/20210601_043420.png)

자바와 디비 연결하기 위해서는 커넥션이 필요하다.

프로젝트에서 부하가 많이 걸리는 부분이 커넥션 부분(이것저것 확인해야 하므로 로그인이라던가 디비 정보라던가 등등.)

그리고 커넥션을 종료시킨다.(다 끝나면)

근데 mybatis는 이 커넥션을 없애지 않는다.

즉 재활용 하자는게 mybatis의 취지.

커넥션 풀 메모리에다가 미리 커넥션을 만들어둔다.(여러개를 메모리에 만들어 둠.)


미리 만들어 둔걸 커넥션 풀이라 한다.

만약 자바에서 디비 작업을 하고싶은데(crud)
커넥션에서 꺼내와서 작업하고 커넥션 풀에 반납

다른 사람도 커넥션 쓰고 반납.

![20210601_043746](/assets/20210601_043746.png)

왼쪽의 xml 쭉 해석해서 pooled로 커넥션 만들어서  sql세션에 (팩토리)를 만듬

커넥션 풀을 가리키는 걸 sqlSessionFactory라고 한다.


근데 mybatis는 커넥션을 sqlSession이라 한다.
jdbc는 커넥션이라 하지만 mybatis는 세션이라고 한다.

![20210601_044627](/assets/20210601_044627.png)

연결되어있는 객체들 하나하나들을 sql세션이라고 한다.

그리고 그 세션이 모아져 있는 곳이 팩토리다.

mybatis에서 가장 중요한건 환경설정 파일 읽어서
팩토리에 커넥션 풀을 만들어 이걸 가리키는 sql세션 팩토리를 만들어내는 작업.

그래야 세션을 꺼내와서 디비 작업이 가능하다.

![20210601_044815](/assets/20210601_044815.png)

xml로 부터!
